<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서로의 '결' 알아보기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto+Sans+KR', sans-serif; }
        .question-card { 
            transition: all 0.3s ease-in-out; 
            position: relative; /* 뱃지 위치 기준 */
            padding-top: 1.5rem; /* 뱃지 공간 확보 */
        }
        .question-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
        }
        /* 질문 유형 뱃지 스타일 */
        .question-type-badge {
            position: absolute;
            top: -1px; /* 카드 상단 테두리에 걸치도록 */
            right: 1rem;
            font-size: 0.75rem; /* 12px */
            font-weight: 500;
            padding: 0.125rem 0.5rem; /* 2px 8px */
            border-radius: 0 0 0.375rem 0.375rem; /* 0 0 6px 6px */
            background-color: #4f46e5; /* indigo-700 */
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .badge-similarity { background-color: #059669; } /* emerald-600 */
        .badge-crossover { background-color: #db2777; } /* pink-600 */
        .badge-dynamic { background-color: #d97706; } /* amber-600 */

        .dynamic-followup { 
            background-color: #fefce8; /* yellow-50 */
            border-top: 2px dashed #facc15; /* yellow-400 */
            margin-top: 1rem; 
            padding: 1rem; 
            border-radius: 0.375rem;
        }
        .result-tag { background-color: #f0f0f0; color: #374151; }
        .brain-type-header { 
            font-size: 1.125rem; /* text-lg */
            font-weight: 700; /* font-bold */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 0.5rem; /* mb-2 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        .male-header { border-bottom: 2px solid #93c5fd; color: #1e40af; }
        .female-header { border-bottom: 2px solid #f9a8d4; color: #9d174d; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        
        /* 커스텀 라디오 버튼 스타일 */
        input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25em;
            height: 1.25em;
            border: 2px solid #d1d5db; /* gray-300 */
            border-radius: 50%;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            position: relative;
            top: 0.2em;
            margin-right: 0.5em;
        }
        input[type="radio"]:checked {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5;
        }
        input[type="radio"]:checked::after {
            content: '';
            display: block;
            width: 0.5em;
            height: 0.5em;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        input[type="radio"]:hover {
             border-color: #6366f1; /* indigo-500 */
        }
        /* 라디오 버튼 레이블 */
        label {
            display: block;
            border: 1px solid #e5e7eb; /* gray-200 */
            padding: 0.75rem; /* p-3 */
            border-radius: 0.5rem; /* rounded-lg */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        label:hover {
            background-color: #f9fafb; /* gray-50 */
            border-color: #a5b4fc; /* indigo-300 */
        }
        /* 체크된 항목의 레이블 */
        input[type="radio"]:checked + span {
            font-weight: 600;
            color: #3730a3; /* indigo-800 */
        }
        label:has(input[type="radio"]:checked) {
             background-color: #eef2ff; /* indigo-50 */
             border-color: #6366f1; /* indigo-500 */
        }


        /* 애니메이션 */
        .fade-in { animation: fadeIn 1s ease-in-out forwards; }
        .fade-in-delay-1 { animation-delay: 0.2s; }
        .fade-in-delay-2 { animation-delay: 0.4s; }
        .fade-in-delay-3 { animation-delay: 0.6s; }
        .fade-in-delay-4 { animation-delay: 0.8s; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="main-container" class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">서로의 '결' 알아보기</h1>
            <p class="mt-2 text-gray-600">질문에 답하고 두 분의 고유한 '결'과 매칭률을 확인해보세요.</p>
        </header>

        <div class="mb-8 max-w-4xl mx-auto bg-indigo-50 p-4 rounded-lg text-sm text-gray-700 border border-indigo-200">
            <details>
                <summary class="font-semibold text-center text-indigo-800 mb-2 cursor-pointer">💡 점수 계산 방식 안내 (클릭하여 확인)</summary>
                <div class="mt-2 space-y-3">
                    <p class="font-semibold">질문 유형은 3가지입니다 (유사성 / 선호성 교차 / 선호성 다이나믹)</p>
                    <div>
                        <p class="font-semibold">💖 최종 매칭률 (총점):</p>
                        <p>- 아래의 '유사성 점수'와 '선호성 점수'를 합산하여 계산합니다.</p>
                    </div>
                    <div>
                        <p class="font-semibold">🤝 유사성 점수 (나와 너의 모습이 얼마나 같은가?):</p>
                        <p>- '유사성' 유형의 질문에서 두 분의 답변이 <strong>완전히 일치</strong>하면 **2점**을 얻습니다.<br>
                           - 답변이 다르더라도 <strong>같은 '결' 그룹</strong>에 속하면 **1.5점**을 얻습니다.
                        </p>
                    </div>
                    <div>
                        <p class="font-semibold">🎯 선호성 점수 (서로가 원하는 모습에 얼마나 부합하는가?):</p>
                        <p>
                           - **'선호성 (교차)'**: [내가 선호하는 파트너의 모습]과 [파트너의 실제 모습]이 일치할 때 **2점**을 얻습니다. (양측 모두 계산)<br>
                           - **'선호성 (동적)'**:
                             1. [나의 기본 성향]과 [파트너의 기본 성향]이 일치하면 **2점**을 얻습니다. (다르지만 같은 '결' 그룹이면 1.5점)<br>
                             2. 기본 성향이 일치할 때, [나의 심도]와 [파트너의 심도]가 일치하면 추가 **2점**을, 1단계 차이나면 **1.5점**, 2단계 차이나면 **1점**을 얻습니다.<br>
                             3. 기본 성향과 '결' 그룹이 모두 달라도, [심도]라도 일치하면 보너스 **0.5점**을 얻습니다.
                        </p>
                    </div>
                    <div>
                        <p class="font-semibold">👤 개인 '결'별 수치:</p>
                        <p>- 각 '결'의 <strong>개인 수치</strong>는 '유사성' 및 '선호성' 질문에서 <strong>'나의 모습'</strong>으로 답한 항목들의 성향 그룹 횟수입니다.</p>
                    </div>
                    <p class="font-semibold mt-2">※ 6가지 성향 그룹 (결)</p>
                     <div id="group-descriptions" class="space-y-3 text-xs"></div>
                </div>
            </details>
        </div>

        <div id="question-section">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-blue-50 p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-center mb-6 text-blue-800">🤵‍♂️ 남자</h2>
                    <div id="male-questions" class="space-y-6"></div>
                </div>
                <div class="bg-pink-50 p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-center mb-6 text-pink-800">👰‍♀️ 여자</h2>
                    <div id="female-questions" class="space-y-6"></div>
                </div>
            </div>
            <div class="text-center mt-8">
                <div id="warning-message" class="mb-4 text-center text-red-500 font-semibold hidden">
                    모든 질문에 답변해주세요! (동적 질문 포함)
                </div>
                <button id="random-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105 shadow-lg mr-4">
                    랜덤으로 답변하기
                </button>
                <button id="calculate-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105 shadow-lg">
                    결과 확인하기
                </button>
            </div>
        </div>

        <div id="results" class="hidden mt-8 md:mt-12 bg-white p-8 rounded-2xl shadow-2xl text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 opacity-0 fade-in">최종 결과</h2>
            
            <div class="my-8 opacity-0 fade-in fade-in-delay-1">
                <p class="text-lg text-gray-600">두 분의 가치관 매칭률은...</p>
                <p id="matching-score" class="text-6xl font-extrabold text-indigo-500 my-4">0점 / 0점</p>
                <div class="w-full bg-gray-200 rounded-full h-4 max-w-lg mx-auto">
                    <div id="score-bar" class="bg-indigo-500 h-4 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                </div>
                
                <!-- 분리된 점수 표시 -->
                <div class="flex justify-center gap-8 mt-6 max-w-lg mx-auto">
                    <div class="flex-1 text-center">
                        <p class="font-semibold text-gray-700">🤝 유사성 점수</p>
                        <p id="similarity-score" class="text-2xl font-bold text-blue-600">0점 / 0점</p>
                    </div>
                    <div class="flex-1 text-center">
                        <p class="font-semibold text-gray-700">🎯 선호성 점수</p>
                        <p id="preference-score" class="text-2xl font-bold text-pink-600">0점 / 0점</p>
                    </div>
                </div>
            </div>

            <!-- 상세 점수 분석 -->
            <div class="mt-8 pt-6 border-t opacity-0 fade-in fade-in-delay-2">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">📈 '결'별 상세 분석</h3>
                <p class="text-gray-600 text-sm mb-4">(※ '나의 모습'으로 답한 성향의 분포입니다)</p>
                <div id="score-breakdown" class="max-w-3xl mx-auto text-left space-y-4"></div>
            </div>

            <div class="mt-8 pt-6 border-t opacity-0 fade-in fade-in-delay-3">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">✨ 우리의 종합 '결'</h3>
                <div id="combined-gradient" class="w-full h-32 md:h-40 rounded-2xl flex items-center justify-center relative overflow-hidden shadow-inner">
                     <p id="gradient-text" class="text-white text-3xl font-bold" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">Our Vibe</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8 opacity-0 fade-in fade-in-delay-4">
                <!-- 남자 결과 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border">
                    <p class="text-gray-600 font-semibold">🤵‍♂️ 남자의 '결'은...</p>
                    <div id="result-visual-male" class="mt-4 p-6 rounded-lg transition-all duration-500">
                        <h3 id="result-profile-text-male" class="text-2xl font-extrabold text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.4);"></h3>
                    </div>
                    <div class="mt-4 text-left">
                        <p id="result-group-name-male" class="font-bold text-lg text-gray-800"></p>
                        <p id="result-group-description-male" class="text-gray-600 mt-1 text-sm"></p>
                    </div>
                </div>
                <!-- 여자 결과 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border">
                    <p class="text-gray-600 font-semibold">👰‍♀️ 여자의 '결'은...</p>
                    <div id="result-visual-female" class="mt-4 p-6 rounded-lg transition-all duration-500">
                        <h3 id="result-profile-text-female" class="text-2xl font-extrabold text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.4);"></h3>
                    </div>
                    <div class="mt-4 text-left">
                        <p id="result-group-name-female" class="font-bold text-lg text-gray-800"></p>
                        <p id="result-group-description-female" class="text-gray-600 mt-1 text-sm"></p>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t opacity-0 fade-in fade-in-delay-4">
                <h3 class="text-xl font-bold text-gray-800 mb-4">💌 두 분의 관계 조언</h3>
                <p id="relationship-advice" class="text-gray-700 bg-gray-100 p-4 rounded-lg"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8 pt-6 border-t opacity-0 fade-in fade-in-delay-4">
                 <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4">남자의 상세 성향 태그</h3>
                    <div id="male-tags" class="flex flex-wrap gap-2 justify-center"></div>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4">여자의 상세 성향 태그</h3>
                    <div id="female-tags" class="flex flex-wrap gap-2 justify-center"></div>
                </div>
            </div>

            <div class="mt-12 opacity-0 fade-in fade-in-delay-4">
                 <button id="retry-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-8 rounded-full text-lg">
                    다시하기
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 데이터 구조 정의 ---
        
        // (총 24개 질문)
        // *** brainType 기준으로 정렬됨 ***
        const questions = [
            // --- A. Action (나의 행동 유형) ---
            {
                id: 'q1',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Action (나의 행동 유형)',
                text: '인스타그램 스토리에 사진을 올린다면 어떤 사진을 선택하시겠어요?',
                options: [
                     { 
                        value: '1', text: '아름다운 자연경관에서 찍은 내 사진 (경험중시형)', tag: '#경험중시형',
                        followup: {
                            text: '얼마나 자주 자연으로 떠나시나요?',
                            options: [
                                { value: '1_1', text: '주말마다 시간이 나면 떠남 (심도 3)' },
                                { value: '1_2', text: '한두 달에 한 번은 꼭 감 (심도 2)' },
                                { value: '1_3', text: '마음은 있지만 1년에 한두 번 (심도 1)' }
                            ]
                        }
                     },
                     { 
                        value: '2', text: '미슐랭 5스타 고급 레스토랑의 음식 사진 (성취지향형)', tag: '#성취지향형',
                        followup: {
                            text: '맛집 탐방에 얼마나 진심이신가요?',
                            options: [
                                { value: '2_1', text: '웨이팅 2시간도 감수, 월급의 절반은 식비 (심도 3)' },
                                { value: '2_2', text: '유명한 곳은 찾아가지만, 웨이팅 1시간 이내 (심도 2)' },
                                { value: '2_3', text: '지나가다 보이면 가보는 정도 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '친구들과 함께 파티를 즐기는 역동적인 사진 (사교형)', tag: '#사교형',
                        followup: {
                            text: '당신의 파티/모임 빈도는?',
                            options: [
                                { value: '3_1', text: '거의 매주 약속이 꽉 참 (심도 3)' },
                                { value: '3_2', text: '한 달에 한두 번 정도는 시끌벅적하게 놈 (심도 2)' },
                                { value: '3_3', text: '가끔이지만, 한번 놀 때 제대로 놈 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '인스타그램 스토리는 잘 올리지 않는 편 (안정지향형)', tag: '#안정지향형',
                        followup: {
                            text: 'SNS를 잘 하지 않는 이유는?',
                            options: [
                                { value: '4_1', text: '내 사생활을 노출하는 것이 싫음 (심도 3)' },
                                { value: '4_2', text: '단순히 귀찮아서 (심도 2)' },
                                { value: '4_3', text: '눈팅은 하지만, 올릴 사진이 없음 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q2',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Action (나의 행동 유형)',
                text: '선호하는 운동 스타일은 무엇인가요?',
                options: [
                     { 
                        value: '1', text: '혼자 집중하며 즐기는 운동 (러닝, 헬스 등) (자기계발형)', tag: '#자기계발형',
                        followup: {
                            text: '운동의 주된 목적은 무엇인가요?',
                            options: [
                                { value: '1_1', text: '확실한 근성장과 자기만족 (심도 3)' },
                                { value: '1_2', text: '스트레스 해소와 정신 수양 (심도 2)' },
                                { value: '1_3', text: '건강 유지를 위한 최소한의 활동 (심도 1)' }
                            ]
                        }
                     },
                     { 
                        value: '2', text: '파트너나 팀과 함께하는 운동 (테니스, 축구 등) (활동적인)', tag: '#활동적인',
                        followup: {
                            text: '팀 스포츠를 선호하는 이유는?',
                            options: [
                                { value: '2_1', text: '승부욕과 성취감, "팀플레이"가 좋음 (심도 3)' },
                                { value: '2_2', text: '운동 후 이어지는 뒤풀이와 사교 활동 (심도 2)' },
                                { value: '2_3', text: '혼자 하면 재미없고 금방 질려서 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '운동은 별로 즐기지 않음 (정적인)', tag: '#정적인',
                        followup: {
                            text: '운동을 즐기지 않는다면, 주로 어떤 활동을 하시나요?',
                            options: [
                                { value: '3_1', text: '차라리 그 시간에 잠을 더 자거나 누워있음 (심도 3)' },
                                { value: '3_2', text: '독서, 영화 감상 등 정적인 취미 활동 (심도 2)' },
                                { value: '3_3', text: '숨쉬기 운동 정도 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q22',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Action (나의 행동 유형)',
                text: '당신의 이상적인 주말은 어떤 모습에 가까운가요?',
                options: [
                     { 
                        value: '1', text: '집에서 편안하게 휴식을 취하며 재충전 (집순이/집돌이)', tag: '#집순이/집돌이',
                        followup: {
                            text: '집에서 주로 무엇을 하며 시간을 보내시나요?',
                            options: [
                                { value: '1_1', text: '밀린 잠 자기, 넷플릭스 정주행 등 완전한 "쉼" (심도 3)' },
                                { value: '1_2', text: '요리, 청소, 취미생활 등 집 안에서 할 일을 함 (심도 2)' },
                                { value: '1_3', text: '약속 없는 날 어쩔 수 없이 집에 있음 (심도 1)' }
                            ]
                        }
                     },
                     { 
                        value: '2', text: '새로운 것을 배우거나 취미 활동에 몰두 (자기계발형)', tag: '#자기계발형',
                         followup: {
                            text: '자기계발/취미 활동의 빈도는?',
                            options: [
                                { value: '2_1', text: '주말 중 하루는 꼭 자기계발/취미에 투자 (심도 3)' },
                                { value: '2_2', text: '한 달에 한두 번 원데이 클래스 등 참여 (심도 2)' },
                                { value: '2_3', text: '관심은 많지만 실천은 잘 못함 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '친구들을 만나거나 새로운 사람들과 어울림 (사교형)', tag: '#사교형',
                        followup: {
                            text: '주말 약속이 없을 때 당신의 기분은?',
                            options: [
                                { value: '3_1', text: '불안함, 어떻게든 약속을 만들어야 함 (심도 3)' },
                                { value: '3_2', text: '가끔은 집에서 쉬는 것도 좋음 (심도 2)' },
                                { value: '3_3', text: '오히려 좋아! 쉴 수 있는 기회 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '가까운 곳으로 여행을 떠나 새로운 경험 (모험추구형)', tag: '#모험추구형',
                        followup: {
                            text: '여행을 떠나는 스타일에 가깝다면?',
                            options: [
                                { value: '4_1', text: '무계획 즉흥 여행, 낯선 곳 탐험 선호 (심도 3)' },
                                { value: '4_2', text: '맛집, 명소 등 계획을 세워 떠나는 여행 (심도 2)' },
                                { value: '4_3', text: '여행보다 호캉스가 좋음 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'qc5', // 추가된 선호성 (교차) 5
                type: 'crossover',
                brainType: 'Action (나의 행동 유형)',
                text_me: "나는 데이트 코스를 주로 어떻게 정하는 편인가요?",
                text_partner: "연인이 데이트 코스를 어떻게 정해주길 바라나요?",
                options: [
                     { value: '1', text: "맛집, 카페, 동선까지 완벽하게 계획 (계획형)", tag: '#계획형'},
                     { value: '2', text: "가고 싶은 곳 몇 개만 정하고 즉흥적으로 (자유추구형)", tag: '#자유추구형'},
                     { value: '3', text: "무조건 상대방이 하자는 대로 따름 (수용형)", tag: '#배려형'},
                     { value: '4', text: "새로운 장소, 핫플레이스 위주로 탐색 (모험추구형)", tag: '#모험추구형'}
                 ]
            },

            // --- B. Emotion (나의 감정 및 관계 유형) ---
            {
                id: 'q4',
                type: 'similarity', // 유사성
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text: '꿈꾸는 프러포즈는 어떤 모습인가요?',
                options: [
                     { value: '1', text: '분위기 좋은 레스토랑에서의 로맨틱한 프러포즈 (낭만주의형)', tag: '#낭만주의형'},
                     { value: '2', text: '많은 사람들 앞에서의 깜짝 프러포즈 (이벤트선호)', tag: '#이벤트선호'},
                     { value: '3', text: '둘만의 추억이 담긴 장소에서의 진솔한 프러포즈 (관계중심형)', tag: '#관계중심형'},
                     { value: '4', text: '화려함보다 진심이 담긴 반지와 편지 (실용주의형)', tag: '#실용주의형'}
                 ]
            },
            {
                id: 'q5',
                type: 'crossover', // 선호성 (교차)
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text_me: '연인이 했을 때 가장 설레는 행동은 무엇인가요? (나의 선호)',
                text_partner: '연인을 가장 설레게 하는 나의 행동은 무엇이라고 생각하나요? (파트너 선호)',
                options: [
                     { value: '1', text: '내가 했던 말을 기억하고 세심하게 챙겨줄 때 (세심함중시)', tag: '#세심함중시'},
                     { value: '2', text: '힘든 하루 끝에 말없이 꼭 안아줄 때 (스킨십중시)', tag: '#스킨십중시'},
                     { value: '3', text: '나의 일이나 성과를 진심으로 응원하고 지지해줄 때 (정서적지지)', tag: '#정서적지지'},
                     { value: '4', text: '함께 시간을 보낼 때 나에게 온전히 집중해줄 때 (시간공유형)', tag: '#시간공유형'}
                 ]
            },
            {
                id: 'q23',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text: '공공장소에서의 애정표현(스킨십)에 대해 어떻게 생각하시나요?',
                options: [
                     { 
                        value: '1', text: '손 잡는 것 정도는 괜찮지만, 그 이상은 조심스러움 (보수적가치관)', tag: '#보수적가치관',
                        followup: {
                            text: '사귀기 전 스킨십에 대한 당신의 생각은?',
                            options: [
                                { value: '1_1', text: '사귀기 전에는 손잡는 것도 안됨 (심도 3)' },
                                { value: '1_2', text: '손잡는 것까지는 가능 (심도 2)' },
                                { value: '1_3', text: '가벼운 포옹까지는 가능 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '2', text: '주변에 피해만 주지 않는다면 자유롭게 표현 가능 (자유로운표현)', tag: '#자유로운표현',
                        followup: {
                            text: '공공장소에서 가능한 스킨십의 최대 범위는?',
                            options: [
                                { value: '2_1', text: '키스까지도 가능 (심도 3)' },
                                { value: '2_2', text: '가벼운 입맞춤이나 포옹 정도 (심도 2)' },
                                { value: '2_3', text: '손잡고 팔짱 끼는 정도 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '애정표현은 둘만 있는 사적인 공간에서 하는 것이 좋음 (사생활중시)', tag: '#사생활중시',
                        followup: {
                            text: '공공장소에서 손잡는 것도 꺼려지시나요?',
                            options: [
                                { value: '3_1', text: '그렇다, 손잡는 것도 불편함 (심도 3)' },
                                { value: '3_2', text: '손잡는 건 괜찮지만, 그 이상은 절대 불가 (심도 2)' },
                                { value: '3_3', text: '상황에 따라 손잡기/팔짱은 가능 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '장소와 분위기에 따라 유연하게 달라질 수 있음 (상황적응형)', tag: '#상황적응형',
                        followup: {
                            text: '애정표현에 있어 가장 중요하게 고려하는 것은?',
                            options: [
                                { value: '4_1', text: '주변 사람들의 시선 (심도 3)' },
                                { value: '4_2', text: '그 순간의 감정과 분위기 (심도 2)' },
                                { value: '4_3', text: '상대방의 의사 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q26',
                type: 'similarity', // 유사성
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text: '비 오는 날, 퇴근 시간에 맞춰 연인이 회사 앞에 우산을 들고 나타났습니다. 당신의 반응은?',
                options: [
                     { value: '1', text: '우와, 어떻게 알고 왔어? 와줘서 정말 고마워! (감정표현형)', tag: '#감정표현형'},
                     { value: '2', text: '괜찮은데 왜 고생스럽게 왔어~ 걱정되잖아 (배려형)', tag: '#배려형'},
                     { value: '3', text: '마침 보고 싶었는데, 이렇게 깜짝으로 보니 더 좋다! (낭만주의형)', tag: '#낭만주의형'},
                     { value: '4', text: '잘 왔다! 이왕 만났으니 맛있는 거 먹으러 갈까? (실용주의형)', tag: '#실용주의형'}
                 ]
            },
            {
                id: 'q17',
                type: 'similarity', // 유사성
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text: "내 연인이 내 친구(이성)의 깻잎을 떼주는 것을 보았습니다. 당신의 생각은?",
                options: [
                     { value: '1', text: '아무렇지 않음. 그럴 수 있음 (쿨한연애)', tag: '#쿨한연애'},
                     { value: '2', text: '기분은 좀 그렇지만 티 내지 않음 (감정조절형)', tag: '#감정조절형'},
                     { value: '3', text: '연인에게 장난스럽게 서운함을 표현함 (관계중심형)', tag: '#관계중심형'},
                     { value: '44', text: '절대 안됨. 그 자리에서 이야기함 (원칙주의형)', tag: '#원칙주의형'} // 4 중복
                 ]
            },
            {
                id: 'q18',
                type: 'similarity', // 유사성
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text: '선호하는 반려동물이 있나요?',
                options: [
                     { value: '1', text: '활동적이고 애교 많은 강아지가 좋음 (활동적인)', tag: '#활동적인'},
                     { value: '2', text: '독립적이고 차분한 고양이가 좋음 (차분한)', tag: '#차분한'},
                     { value: '3', text: '둘 다 좋지만, 키울 자신은 없음 (현실주의형)', tag: '#현실주의형'},
                     { value: '4', text: '반려동물을 키우는 것은 선호하지 않음 (개인주의형)', tag: '#개인주의형'}
                 ]
            },
            {
                id: 'qc1', // 추가된 선호성 (교차) 1
                type: 'crossover', 
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text_me: "나는 기념일을 어떻게 챙기는 편인가요?",
                text_partner: "연인이 기념일을 어떻게 챙겨주길 바라나요?",
                options: [
                     { value: '1', text: '서프라이즈 이벤트와 특별한 선물 (이벤트선호)', tag: '#이벤트선호'},
                     { value: '2', text: '함께 분위기 좋은 곳에서 식사 (낭만주의형)', tag: '#낭만주의형'},
                     { value: '3', text: '서로 갖고 싶었던 실용적인 선물 교환 (실용주의형)', tag: '#실용주의형'},
                     { value: '4', text: '거창한 것보다 진심이 담긴 손편지 (관계중심형)', tag: '#관계중심형'}
                 ]
            },
            {
                id: 'qc4', // 추가된 선호성 (교차) 4
                type: 'crossover',
                brainType: 'Emotion (나의 감정 및 관계 유형)',
                text_me: "나는 다툼 후에 어떻게 화해하는 편인가요?",
                text_partner: "연인이 다툼 후에 어떻게 화해를 시도하길 바라나요?",
                options: [
                     { value: '1', text: "시간이 좀 걸리더라도, 끝까지 대화로 풂 (논리적대화)", tag: '#논리적대화'},
                     { value: '2', text: "맛있는 음식을 먹거나 선물을 주며 자연스럽게 (실용주의형)", tag: '#실용주의형'},
                     { value: '3', text: "먼저 애교를 부리거나 스킨십으로 풀어줌 (스킨십중시)", tag: '#스킨십중시'},
                     { value: '4S', text: "일단 빨리 사과하고 넘어감 (갈등회피형)", tag: '#갈등회피형'} // 4 중복
                 ]
            },

            // --- C. Thinking (나의 가치관 및 생각 유형) ---
            {
                id: 'qc2', // 추가된 선호성 (교차) 2
                type: 'crossover',
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text_me: "나는 평소 소비/저축 습관이 어떤 편인가요?",
                text_partner: "연인이 어떤 소비/저축 습관을 가졌으면 하나요?",
                options: [
                     { value: '1', text: "현재의 행복이 중요, 갖고 싶은 건 산다 (YOLO)", tag: '#모험추구형'},
                     { value: '2', text: "필요한 건 사지만, 가성비를 꼼꼼히 따짐 (실용주의형)", tag: '#실용주의형'},
                     { value: '3', text: "미래를 위해 소득의 50% 이상은 저축/투자 (안정적투자)", tag: '#안정적투자'},
                     { value: '4', text: "잘 모르겠음, 버는 만큼 씀 (상황적응형)", tag: '#상황적응형'}
                 ]
            },
            {
                id: 'qc3', // 추가된 선호성 (교차) 3
                type: 'crossover',
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text_me: "나는 연인과의 연락 빈도에 대해 어떻게 생각하나요?",
                text_partner: "연인이 어느 정도의 빈도로 연락해주길 바라나요?",
                options: [
                     { value: '1', text: "틈날 때마다 일상을 공유하는 편 (관계중심형)", tag: '#관계중심형'},
                     { value: '2', text: "출근, 점심, 퇴근 등 주요 시간에만 연락 (안정지향형)", tag: '#안정지향형'},
                     { value: '3', text: "서로 바쁠 땐 저녁에만 연락해도 OK (독립성중시)", tag: '#독립성중시'},
                     { value: '4', text: "용건이 있을 때만 연락해도 상관없음 (쿨한연애)", tag: '#쿨한연애'}
                 ]
            },
            {
                id: 'qc6', // 추가된 선호성 (교차) 6
                type: 'crossover',
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text_me: "나는 연인의 이성 친구 관계를 어디까지 허용하나요?",
                text_partner: "연인이 나의 이성 친구 관계를 어디까지 허용해주길 바라나요?",
                options: [
                     { value: '1', text: "단체 모임까지만 가능 (보수적가치관)", tag: '#보수적가치관'},
                     { value: '2', text: "1:1 식사나 낮술까지 가능 (상황적응형)", tag: '#상황적응형'},
                     { value: '3', text: "1:1 저녁 술자리도 가능 (쿨한연애)", tag: '#쿨한연애'},
                     { value: '4', text: "이성 친구는 절대 안 됨 (원칙주의형)", tag: '#원칙주의형'}
                 ]
            },
            {
                id: 'q11',
                type: 'similarity', // 유사성
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '성공한 친구가 확실한 투자처라며 주식 정보를 주었습니다. 어떻게 하시겠어요?',
                options: [
                     { value: '1', text: "친구를 믿고 '영끌' 대출을 해서 투자 (과감한투자)", tag: '#과감한투자'},
                     { value: '2', text: '현재 보유한 현금 전부를 투자 (공격적투자)', tag: '#공격적투자'},
                     { value: '3', text: '여유 자금의 절반 정도만 신중하게 투자 (안정적투자)', tag: '#안정적투자'},
                     { value: '4', text: '스스로 분석 없이는 투자하지 않음 (원칙주의형)', tag: '#원칙주의형'}
                 ]
            },
             {
                id: 'q19',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '연인과 갈등이 생겼을 때, 당신은 어떻게 해결하나요?',
                options: [
                     { 
                        value: '1', text: '감정이 가라앉을 때까지 기다렸다가 차분히 대화 (논리적대화)', tag: '#논리적대화',
                        followup: {
                            text: '얼마나 기다렸다가 대화하는 것을 선호하시나요?',
                            options: [
                                { value: '1_1', text: '최소 하루는 지나야 함 (심도 3)' },
                                { value: '1_2', text: '몇 시간 정도, 당일 자기 전에는 풀기 (심도 2)' },
                                { value: '1_3', text: '10분 정도 감정만 가라앉히고 바로 대화 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '2', text: '갈등이 길어지는게 싫어 빨리 사과하고 넘어감 (갈등회피형)', tag: '#갈등회피형',
                        followup: {
                            text: '갈등이 생겼을 때 주로 누가 먼저 사과하나요?',
                            options: [
                                { value: '2_1', text: '내 잘못이 아니어도 무조건 내가 먼저 사과 (심도 3)' },
                                { value: '2_2', text: '상황 봐서 내가 잘못한 것 같으면 먼저 사과 (심도 2)' },
                                { value: '2_3', text: '빠르게 사과하되, 상대가 먼저 해주길 바람 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '감정을 솔직하게 모두 표현해야 직성이 풀림 (감정표현형)', tag: '#감정표현형',
                        followup: {
                            text: '감정을 표현할 때 당신의 모습은?',
                            options: [
                                { value: '3_1', text: '울음이 터지거나 언성이 높아지기도 함 (심도 3)' },
                                { value: '3_2', text: '서운한 점을 차분하지만 단호하게 다 말함 (심도 2)' },
                                { value: '3_3', text: '감정을 표현하되, 상대방 기분을 살핌 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '함께 문제를 분석하고 해결책을 찾으려 노력함 (문제해결형)', tag: '#문제해결형',
                        followup: {
                            text: '문제 해결 과정에서 가장 중요한 것은?',
                            options: [
                                { value: '4_1', text: '같은 실수를 반복하지 않을 명확한 규칙 정하기 (심도 3)' },
                                { value: '4_2', text: '서로의 입장을 이해하고 합의점 찾기 (심도 2)' },
                                { value: '4_3', text: '일단 문제를 파악하는 것 자체가 중요 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q27',
                type: 'similarity', // 유사성
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '배우자가 청소기를 돌렸는데 구석에 먼지가 그대로 있습니다. 당신의 반응은?',
                options: [
                     { value: '1', text: '우와, 청소해줬네! 정말 고마워~ (긍정적강화)', tag: '#긍정적강화'},
                     { value: '2', text: '고마워! 다음엔 이쪽 구석도 한번 더 신경 써주면 완벽할 것 같아! (피드백제공)', tag: '#피드백제공'},
                     { value: '3', text: '말없이 내가 직접 나머지 먼지를 청소함 (갈등회피형)', tag: '#갈등회피형'},
                     { value: '4', text: '그 정도는 괜찮음. 신경 쓰지 않음 (자유로운)', tag: '#자유로운'}
                 ]
            },
            {
                id: 'q24',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '결혼 후 양가 부모님 댁 방문 빈도는 어느 정도가 적당하다고 생각하시나요?',
                options: [
                     { 
                        value: '1', text: '명절이나 생신 등 특별한 날에만 방문 (독립성중시)', tag: '#독립성중시',
                        followup: {
                            text: '부모님의 갑작스러운 방문이나 연락에 대한 생각은?',
                            options: [
                                { value: '1_1', text: '연락 없는 방문은 절대 불가, 연락도 용건만 (심도 3)' },
                                { value: '1_2', text: '방문은 미리 합의해야 함, 안부 연락은 OK (심도 2)' },
                                { value: '1_3', text: '가까이 살지 않으니 가끔은 괜찮음 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '2', text: '한두 달에 한 번 정도는 정기적으로 방문 (가족중심형)', tag: '#가족중심형',
                        followup: {
                            text: '부모님과 얼마나 가깝게 지내고 싶으신가요?',
                            options: [
                                { value: '2_1', text: '식사, 여행도 함께하는 친밀한 관계 (심도 3)' },
                                { value: '2_2', text: '정기적 교류는 하되, 우리 가정의 독립성 보장 (심도 2)' },
                                { value: '2_3', text: '도리를 다하는 수준, 너무 가까우면 부담 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '정해진 것 없이, 필요하거나 원할 때 자유롭게 왕래 (자유추구형)', tag: '#자유추구형',
                        followup: {
                            text: '방문 빈도를 정하지 않는 이유는?',
                            options: [
                                { value: '3_1', text: '의무적인 방문은 스트레스, 내킬 때만 (심도 3)' },
                                { value: '3_2', text: '상황(거리, 일정)에 따라 유연하게 (심도 2)' },
                                { value: '3_3', text: '가까이 살면 자주, 멀리 살면 어쩔 수 없음 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '가까이 살면서 자주 왕래하며 가깝게 지냄 (관계중심형)', tag: '#관계중심형',
                        followup: {
                            text: '부모님 댁과 어느 정도의 거리를 선호하시나요?',
                            options: [
                                { value: '4_1', text: '아예 모시고 살거나, 바로 옆 동 (심도 3)' },
                                { value: '4_2', text: '차로 10~30분 이내의 가까운 거리 (심도 2)' },
                                { value: '4_3', text: '마음은 가깝지만, 물리적 거리는 있는 게 좋음 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
             {
                id: 'q25',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '가사(집안일) 분담에 대한 당신의 생각은?',
                options: [
                     { 
                        value: '1', text: '각자 잘하는 일을 정해서 명확하게 역할을 나눔 (효율중시형)', tag: '#효율중시형',
                        followup: {
                            text: '상대방이 자기 역할을 제대로 안 할 때 당신의 반응은?',
                            options: [
                                { value: '1_1', text: '즉시 이야기하고 규칙을 다시 정함 (심도 3)' },
                                { value: '1_2', text: '몇 번 참다가 좋게 이야기함 (심도 2)' },
                                { value: '1_3', text: '말없이 내가 대신 해줌 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '2', text: '정해놓지 않고, 시간이 되거나 먼저 보는 사람이 함 (자율형)', tag: '#자율형',
                        followup: {
                            text: '만약 나만 계속 집안일을 하게 된다면?',
                            options: [
                                { value: '2_1', text: '상관없음, 내가 더 깔끔하니 내가 함 (심도 3)' },
                                { value: '2_2', text: '기분이 나쁨, 결국 역할을 정하자고 말함 (심도 2)' },
                                { value: '2_3', text: '눈치껏 상대방도 하길 바람 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '주말 등 특정 시간을 정해 함께 집중적으로 처리 (계획형)', tag: '#계획형',
                        followup: {
                            text: '평일에 집이 더러워지는 것에 대한 생각은?',
                            options: [
                                { value: '3_1', text: '매우 불편, 주중에도 최소한의 정리는 함 (심도 3)' },
                                { value: '3_2', text: '조금 불편하지만 주말까지 참음 (심도 2)' },
                                { value: '3_3', text: '어차피 주말에 할 거라 상관없음 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '가사도우미, 식기세척기 등 시스템을 적극 활용 (편리성추구)', tag: '#편리성추구',
                        followup: {
                            text: '시스템 활용에 어느 정도의 비용을 지불할 의향이 있나요?',
                            options: [
                                { value: '4_1', text: '가사노동 해방을 위해서라면 비용은 중요치 않음 (심도 3)' },
                                { value: '4_2', text: '월 소득의 10% 이내에서 합리적으로 지출 (심도 2)' },
                                { value: '4_3', text: '가전제품은 OK, 인력 서비스는 부담됨 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q12',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '이상적인 자녀 수는 몇 명인가요?',
                options: [
                     { 
                        value: '1', text: "딩크(DINK)족, 자녀 없이 둘만의 삶 (개인주의형)", tag: '#개인주의형',
                        followup: {
                            text: '자녀를 갖지 않으려는 가장 큰 이유는?',
                            options: [
                                { value: '1_1', text: '육아로 인한 커리어 단절, 경제적 부담 (심도 3)' },
                                { value: '1_2', text: '부부 둘만의 자유로운 삶을 즐기고 싶어서 (심도 2)' },
                                { value: '1_3', text: '아이를 잘 키울 자신이 없어서 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '2', text: '한 명의 자녀에게 집중 (계획형)', tag: '#계획형',
                        followup: {
                            text: '한 명의 자녀만 생각하는 이유는?',
                            options: [
                                { value: '2_1', text: '경제적, 현실적으로 한 명에게 집중하는 것이 최선 (심도 3)' },
                                { value: '2_2', text: '아이에게 형제를 만들어주고 싶지만, 육아가 힘듦 (심도 2)' },
                                { value: '2_3', text: '일단 한 명 낳아보고, 나중에 생각 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '안정적이고 화목한 두 명의 자녀 (가정중심형)', tag: '#가정중심형',
                        followup: {
                            text: '두 명의 자녀를 원하는 이유는?',
                            options: [
                                { value: '3_1', text: '자녀가 외롭지 않게 형제/자매를 만들어주고 싶음 (심도 3)' },
                                { value: '3_2', text: '내가 두 명의 형제/자매와 자라서 좋았음 (심도 2)' },
                                { value: '3_3', text: '안정적인 가정의 보편적인 모습이라 생각 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '다둥이 가정을 꿈꿈 (다자녀선호)', tag: '#다자녀선호',
                        followup: {
                            text: '다둥이 가정을 원하는 이유는?',
                            options: [
                                { value: '4_1', text: '아이들이 많아 시끌벅적한 가정이 행복함 (심도 3)' },
                                { value: '4_2', text: '경제적 여유만 된다면 많을수록 좋음 (심도 2)' },
                                { value: '4_3', text: '최소 3명, 성별을 맞춰보고 싶음 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q13',
                type: 'dynamic', // 선호성 (동적)
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '선호하는 부부의 경제 활동 형태는 무엇인가요?',
                options: [
                     { 
                        value: '1', text: '각자의 커리어를 존중하는 맞벌이 (성장지향형)', tag: '#성장지향형',
                        followup: {
                            text: '맞벌이를 선호하는 가장 큰 이유는?',
                            options: [
                                { value: '1_1', text: '경제적 안정과 풍요로움 (심도 3)' },
                                { value: '1_2', text: '자아실현과 사회적 성취 (심도 2)' },
                                { value: '1_3', text: '외벌이에 대한 부담감 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '2', text: '상황에 따라 유연하게, 가능하면 맞벌이 (상황적응형)', tag: '#상황적응형',
                        followup: {
                            text: '어떤 상황에 외벌이를 고려할 수 있나요?',
                            options: [
                                { value: '2_1', text: '출산 및 육아기에는 한 사람이 집중 (심도 3)' },
                                { value: '2_2', text: '한 사람의 소득이 압도적으로 높아질 경우 (심도 2)' },
                                { value: '2_3', text: '상대방이 원한다면 언제든 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '3', text: '한 사람은 경제활동, 한 사람은 가정을 돌보는 외벌이 (전통적가치관)', tag: '#전통적가치관',
                        followup: {
                            text: '외벌이를 선호하는 가장 큰 이유는?',
                            options: [
                                { value: '3_1', text: '가정과 육아에 한 사람이 온전히 집중하는 것이 효율적 (심도 3)' },
                                { value: '3_2', text: "소득/커리어보다 '삶의 질'이 더 중요하면 외벌이도 OK (심도 2)" },
                                { value: '3_3', text: '내가 경제활동/가사 중 하나에 더 자신 있음 (심도 1)' }
                            ]
                        }
                    },
                     { 
                        value: '4', text: '경제적 여유만 있다면, 자유롭게 살고 싶음 (자유추구형)', tag: '#자유추구형',
                        followup: {
                            text: '경제 활동을 하지 않는다면 무엇을 하고 싶나요?',
                            options: [
                                { value: '4_1', text: '세계 여행, 끝없는 취미 생활 (심도 3)' },
                                { value: '4_2', text: '돈과 상관없이 하고 싶었던 일 (봉사, 예술 등) (심도 2)' },
                                { value: '4_3', text: '아무것도 안 하고 쉬고 싶음 (심도 1)' }
                            ]
                        }
                    }
                 ]
            },
            {
                id: 'q15',
                type: 'similarity', // 유사성
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '당신이 결혼을 원하는 가장 큰 이유는 무엇인가요?',
                options: [
                     { value: '1', text: '정서적 안정감과 평생의 동반자를 얻기 위해 (안정지향형)', tag: '#안정지향형'},
                     { value: '2', text: '사랑하는 사람과 가정을 꾸리기 위해 (가정중심형)', tag: '#가정중심형'},
                     { value: '3', text: '더 나은 미래를 함께 계획하고 성장하기 위해 (성장지향형)', tag: '#성장지향형'},
                     { value: '4', text: '함께 다양한 경험을 하며 인생을 더 즐겁게 살기 위해 (모험추구형)', tag: '#모험추구형'}
                 ]
            },
            {
                id: 'q16',
                type: 'similarity', // 유사성
                brainType: 'Thinking (나의 가치관 및 생각 유형)',
                text: '신혼집을 구한다면, 당신의 우선순위는 어디에 있나요?',
                options: [
                     { value: '1', text: '미래 가치를 보고 서울 중심지 아파트 선택 (미래가치중시)', tag: '#미래가치중시'},
                     { value: '2', text: '현재의 안정을 위해 경기도 신축 아파트 선택 (현재안정중시)', tag: '#현재안정중시'},
                     { value: '3', text: '직주근접이 가장 중요함 (실용주의형)', tag: '#실용주의형'},
                     { value: '4', text: '개인의 취향이 담긴 인테리어의 집을 원함 (심미주의형)', tag: '#심미주의형'}
                 ]
            },
        ];
                
        // (이하 태그 그룹, 프로필, 단어 정의는 원본과 동일)
        const tagGroups = {
            EMOTIONAL_CONNECT: { tags: ["#낭만주의형", "#관계중심형", "#세심함중시", "#스킨십중시", "#정서적지지", "#배려형", "#감정표현형", "#긍정적강화", "#가족중심형", "#다자녀선호", "#시간공유형"] },
            PRACTICAL_RATIONAL: { tags: ["#실용주의형", "#원칙주의형", "#현실주의형", "#논리적대화", "#문제해결형", "#효율중시형", "#피드백제공", "#미래가치중시"] },
            STABILITY_ORIENTED: { tags: ["#안정지향형", "#안정적투자", "#계획형", "#집순이/집돌이", "#보수적가치관", "#현재안정중시", "#전통적가치관", "#정적인"] },
            ACTIVE_EXPERIENCE: { tags: ["#경험중시형", "#성취지향형", "#사교형", "#활동적인", "#모험추구형", "#이벤트선호", "#과감한투자", "#공격적투자", "#자기계발형", "#성장지향형"] },
            AUTONOMY_FLEXIBILITY: { tags: ["#개인주의형", "#쿨한연애", "#자유로운표현", "#사생활중시", "#자유추구형", "#독립성중시", "#자율형", "#갈등회피형", "#자유로운", "#수용형"] },
            ADAPTIVE_BALANCED: { tags: ["#상황적응형", "#감정조절형", "#편리성추구", "#심미주의형", "#차분한"] }
        };

        const sensoryProfiles = {
            EMOTIONAL_CONNECT: { name: "감성의 결", description: "사람들과의 따뜻한 유대와 감정적 교류에서 행복을 느끼는 사람입니다. 타인의 마음에 깊이 공감하며, 관계를 통해 안정감을 얻는 섬세한 '결'을 가졌습니다.", background: "bg-pink-400", colorCode: "#F9A8D4" },
            PRACTICAL_RATIONAL: { name: "이성의 결", description: "명확한 논리와 효율성을 중요하게 생각하며, 문제 해결에 뛰어난 능력을 보입니다. 감정보다 이성적인 판단을 우선시하는 시원하고 투명한 '결'을 가졌습니다.", background: "bg-blue-500", colorCode: "#3B82F6" },
            STABILITY_ORIENTED: { name: "안정의 결", description: "예측 가능하고 편안한 환경에서 가장 큰 안정감을 느낍니다. 꾸준함과 신뢰를 바탕으로 삶을 단단하게 가꾸어 나가는 차분하고 깊은 '결'을 가졌습니다.", background: "bg-green-500", colorCode: "#22C55E" },
            ACTIVE_EXPERIENCE: { name: "활동의 결", description: "새로운 도전과 경험을 통해 삶의 에너지를 얻는 열정적인 사람입니다. 끊임없이 성장하고 세상을 탐험하고자 하는 반짝이는 '결'을 가졌습니다.", background: "bg-amber-500", colorCode: "#F59E0B" },
            AUTONOMY_FLEXIBILITY: { name: "자유의 결", description: "자신만의 고유한 개성과 자유를 무엇보다 중요하게 생각합니다. 정해진 틀에 얽매이지 않고, 자신만의 속도와 방식으로 세상을 살아가는 신비로운 '결'을 가졌습니다.", background: "bg-purple-500", colorCode: "#8B5CF6" },
            ADAPTIVE_BALANCED: { name: "조화의 결", description: "어떤 상황에서도 유연하게 대처하며, 갈등보다는 조화를 추구합니다. 치우치지 않는 균형감각으로 주변과 자연스럽게 어우러지는 맑고 깨끗한 '결'을 가졌습니다.", background: "bg-gray-500", colorCode: "#6B7280" }
        };
        const sensoryWords = {
            EMOTIONAL_CONNECT: { texture: ["따뜻한", "부드러운", "포근한"], color: ["핑크빛", "복숭아빛"], scent: ["꽃향기", "달콤한 과일향"], shape: ["솜사탕", "실크 스카프", "구름"] },
            PRACTICAL_RATIONAL: { texture: ["시원한", "매끄러운", "단단한"], color: ["하늘색", "회색빛"], scent: ["비 냄새", "민트향"], shape: ["수정", "유리구슬", "얼음 조각"] },
            STABILITY_ORIENTED: { texture: ["단단한", "차분한", "편안한"], color: ["연두색", "갈색빛"], scent: ["나무향", "젖은 흙냄새"], shape: ["조약돌", "나뭇잎", "이끼"] },
            ACTIVE_EXPERIENCE: { texture: ["뜨거운", "톡톡 튀는", "짜릿한"], color: ["노란색", "주황색"], scent: ["상큼한 레몬향", "타오르는 장작 냄새"], shape: ["별", "불꽃", "보석 원석"] },
            AUTONOMY_FLEXIBILITY: { texture: ["신비로운", "오묘한", "가벼운"], color: ["보랏빛", "남색"], scent: ["깊은 밤공기 냄새", "고요한 숲의 향"], shape: ["안개", "자수정", "깃털"] },
            ADAPTIVE_BALANCED: { texture: ["깨끗한", "맑은", "투명한"], color: ["흰색", "투명한"], scent: ["무향(無香)", "맑은 공기 냄새"], shape: ["물방울", "이슬", "백자"] }
        };

        // --- 2. DOM 요소 정의 ---
        const maleQuestionsContainer = document.getElementById('male-questions');
        const femaleQuestionsContainer = document.getElementById('female-questions');
        const calculateBtn = document.getElementById('calculate-btn');
        const randomBtn = document.getElementById('random-btn');
        const resultsContainer = document.getElementById('results');
        const warningMessage = document.getElementById('warning-message');
        const questionSection = document.getElementById('question-section');
        const retryBtn = document.getElementById('retry-btn');
        const combinedGradientEl = document.getElementById('combined-gradient');
        const groupDescriptionsEl = document.getElementById('group-descriptions');

        const matchingScoreEl = document.getElementById('matching-score');
        const scoreBarEl = document.getElementById('score-bar');
        const similarityScoreEl = document.getElementById('similarity-score');
        const preferenceScoreEl = document.getElementById('preference-score');
        const scoreBreakdownEl = document.getElementById('score-breakdown');

        const resultVisualMaleEl = document.getElementById('result-visual-male');
        const resultProfileTextMaleEl = document.getElementById('result-profile-text-male');
        const resultGroupNameMaleEl = document.getElementById('result-group-name-male');
        const resultGroupDescriptionMaleEl = document.getElementById('result-group-description-male');
        const maleTagsEl = document.getElementById('male-tags');

        const resultVisualFemaleEl = document.getElementById('result-visual-female');
        const resultProfileTextFemaleEl = document.getElementById('result-profile-text-female');
        const resultGroupNameFemaleEl = document.getElementById('result-group-name-female');
        const resultGroupDescriptionFemaleEl = document.getElementById('result-group-description-female');
        const femaleTagsEl = document.getElementById('female-tags');
        
        const relationshipAdviceEl = document.getElementById('relationship-advice');

        let maleRadarChart = null;
        let femaleRadarChart = null;
        let comparisonRadarChart = null;
        let totalExpectedAnswers = 0; // 답변해야 할 총 질문 수

        // --- 3. 핵심 유틸 함수 ---
        function findTagGroupKey(tag) {
            for (const key in tagGroups) {
                if (tagGroups[key].tags.includes(tag)) { return key; }
            }
            return null;
        }

        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }
        
        /** 동적 질문 데이터에서 옵션 찾기 */
        function findOptionByValue(q, value) {
            return q.options.find(opt => opt.value === value);
        }
        
        /** 심도 값 추출 (예: '1_1' -> 1, '2_3' -> 3) */
        function getDepthValue(value) {
            if (!value || !value.includes('_')) return 0;
            const depth = parseInt(value.split('_')[1], 10);
            // 심도 값을 3, 2, 1로 정규화 (3이 가장 강함)
            if (depth === 1) return 3;
            if (depth === 2) return 2;
            if (depth === 3) return 1;
            return 0; // 혹시 모를 예외 처리
        }

        // --- 4. 질문 렌더링 로직 (수정됨) ---
        
        /** 동적 질문 생성 함수 */
        function handleDynamic(radio) {
            const gender = radio.name.endsWith('-male') ? 'male' : 'female';
            const qId = radio.name.split('-me-')[0];
            const q = questions.find(q => q.id === qId);
            const selectedOption = findOptionByValue(q, radio.value);
            const followupData = selectedOption ? selectedOption.followup : null;
            
            const followupContainerId = `${qId}-${gender}-followup`;
            const questionCard = radio.closest('.question-card');
            
            // 기존의 동적 질문 컨테이너 제거
            const existingFollowup = questionCard.querySelector('.dynamic-followup');
            if (existingFollowup) {
                existingFollowup.remove();
            }

            if (!followupData) return; // Followup 데이터가 없으면 종료

            // 새 동적 질문 컨테이너 생성
            const followupContainer = document.createElement('div');
            followupContainer.id = followupContainerId;
            followupContainer.className = 'dynamic-followup';

            const optionsHTML = followupData.options.map((opt) => `
                <label>
                    <input type="radio" name="${qId}-followup-${gender}" value="${opt.value}" class="mr-2">
                    <span>${opt.text}</span>
                </label>
            `).join('');

            followupContainer.innerHTML = `
                <p class="font-semibold mb-3 text-gray-800">${followupData.text}</p>
                <div class="space-y-2">${optionsHTML}</div>
            `;
            
            questionCard.appendChild(followupContainer);
        }

        /** 질문 유형에 따라 HTML 생성 */
        function createQuestionHTML(q, gender) {
            let html = '';
            let badgeHTML = '';

            // 질문 유형 뱃지
            if (q.type === 'similarity') {
                badgeHTML = `<span class="question-type-badge badge-similarity">유사성</span>`;
            } else if (q.type === 'crossover') {
                badgeHTML = `<span class="question-type-badge badge-crossover">선호성 (교차)</span>`;
            } else if (q.type === 'dynamic') {
                badgeHTML = `<span class="question-type-badge badge-dynamic">선호성 (동적)</span>`;
            }

            // 공통 옵션 생성기 (메인 질문용)
            // data-followup 속성에 JSON 문자열을 이스케이프 처리하여 저장
            const mainOptionsHTML = q.options.map((opt) => {
                let dataAttr = '';
                if (q.type === 'dynamic' && opt.followup) {
                    // JSON.stringify 과정에서 작은따옴표(')가 포함된 문자열이 깨지지 않도록 &#39;로 이스케이프
                    const followupDataStr = JSON.stringify(opt.followup).replace(/'/g, '&#39;');
                    dataAttr = `data-followup='${followupDataStr}'`;
                }
                return `
                    <label>
                        <input type="radio" name="${q.id}-me-${gender}" value="${opt.value}" data-tag="${opt.tag}" ${dataAttr}>
                        <span>${opt.text}</span>
                    </label>
                `;
            }).join('');

            switch (q.type) {
                case 'similarity':
                    html = `<div class="question-card bg-white p-4 rounded-lg shadow-sm border">
                                ${badgeHTML}
                                <p class="font-semibold mb-3 text-gray-800">${q.text}</p>
                                <div class="space-y-2">${mainOptionsHTML}</div>
                            </div>`;
                    break;
                case 'crossover':
                    const partnerOptionsHTML = q.options.map((opt) => `
                        <label>
                            <input type="radio" name="${q.id}-partner-${gender}" value="${opt.value}" class="mr-2">
                            <span>${opt.text}</span>
                        </label>
                    `).join('');
                    
                    html = `<div class="question-card bg-white p-4 rounded-lg shadow-sm border space-y-4">
                                ${badgeHTML}
                                <div>
                                    <p class="font-semibold mb-3 text-gray-800">${q.text_me}</p>
                                    <div class="space-y-2">${mainOptionsHTML}</div>
                                </div>
                                <hr class="my-4 border-dashed">
                                <div>
                                    <p class="font-semibold mb-3 text-gray-800">${q.text_partner}</p>
                                    <div class="space-y-2">${partnerOptionsHTML}</div>
                                </div>
                            </div>`;
                    break;
                case 'dynamic':
                    html = `<div class="question-card bg-white p-4 rounded-lg shadow-sm border">
                                ${badgeHTML}
                                <p class="font-semibold mb-3 text-gray-800">${q.text}</p>
                                <div class="space-y-2" data-q-id="${q.id}">${mainOptionsHTML}</div>
                                <!-- 동적 질문은 여기에 삽입됨 -->
                            </div>`;
                    break;
            }
            return html;
        }

        /** 전체 질문 렌더링 */
        function renderQuestions() {
            let maleHTML = '', femaleHTML = '', lastMaleBrainType = '', lastFemaleBrainType = '';
            totalExpectedAnswers = 0; // 총 답변 수 초기화

            questions.forEach(q => {
                // 남성 질문 렌더링
                if (q.brainType !== lastMaleBrainType) {
                    maleHTML += `<h3 class="brain-type-header male-header">${q.brainType}</h3>`;
                    lastMaleBrainType = q.brainType;
                }
                maleHTML += createQuestionHTML(q, 'male');
                
                // 여성 질문 렌더링
                if (q.brainType !== lastFemaleBrainType) {
                    femaleHTML += `<h3 class="brain-type-header female-header">${q.brainType}</h3>`;
                    lastFemaleBrainType = q.brainType;
                }
                femaleHTML += createQuestionHTML(q, 'female');

                // 답변해야 할 총 라디오 그룹 수 계산 (남/여 각각)
                if (q.type === 'similarity') totalExpectedAnswers += 1;
                else if (q.type === 'crossover') totalExpectedAnswers += 2;
                else if (q.type === 'dynamic') totalExpectedAnswers += 2; // (기본 1 + 동적 1)
            });
            maleQuestionsContainer.innerHTML = maleHTML;
            femaleQuestionsContainer.innerHTML = femaleHTML;
            
            // 동적 질문을 위한 이벤트 리스너 부착
            // 이벤트 위임을 사용하여 'dynamic' 유형의 질문에만 리스너 추가
            [maleQuestionsContainer, femaleQuestionsContainer].forEach(container => {
                container.addEventListener('change', (event) => {
                    const target = event.target;
                    // 'change' 이벤트가 발생한 라디오 버튼이 '선호성 (동적)' 질문의 메인 답변인지 확인
                    if (target.type === 'radio' && target.name.includes('-me-') && target.hasAttribute('data-followup')) {
                        handleDynamic(target);
                    }
                });
            });
        }

        function renderGroupDescriptions() {
            let html = '';
            for (const key in sensoryProfiles) {
                const profile = sensoryProfiles[key];
                const tags = tagGroups[key].tags.join(', ');
                html += `<div class="p-2 bg-white rounded-md">
                            <p><strong>${profile.name}:</strong> ${profile.description}</p>
                            <p class="mt-1 text-gray-500">포함된 태그: ${tags}</p>
                         </div>`;
            }
            groupDescriptionsEl.innerHTML = html;
        }

        // --- 5. 차트 생성 함수 (원본과 동일) ---
        function generateProfile(groupKey) {
            if (!groupKey || !sensoryWords[groupKey]) {
                // 기본값 또는 오류 처리
                return "다채로운 결의 조화";
            }
            const profileWords = sensoryWords[groupKey];
            const texture = getRandomItem(profileWords.texture);
            const color = getRandomItem(profileWords.color);
            const scent = getRandomItem(profileWords.scent);
            const shape = getRandomItem(profileWords.shape);
            return `${texture} ${color} ${scent}의 ${shape}`;
        }

        function createRadarChart(canvasId, label, data, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
             if (window[canvasId + 'ChartInstance']) { window[canvasId + 'ChartInstance'].destroy(); }
            
            const maxVal = Math.max(...Object.values(data), 3); // 최소값 3 보장
            
            const chartData = {
                labels: Object.values(sensoryProfiles).map(p => p.name.split(' ')[0]),
                datasets: [{
                    label: label,
                    data: Object.keys(sensoryProfiles).map(key => data[key] || 0),
                    backgroundColor: `rgba(${parseInt(color.slice(1, 3), 16)}, ${parseInt(color.slice(3, 5), 16)}, ${parseInt(color.slice(5, 7), 16)}, 0.2)`,
                    borderColor: color,
                    pointBackgroundColor: color,
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: color
                }]
            };
            const options = {
                scales: { r: { angleLines: { display: true }, suggestedMin: 0, suggestedMax: maxVal } },
                plugins: { legend: { position: 'bottom', } }
            };
             window[canvasId + 'ChartInstance'] = new Chart(ctx, { type: 'radar', data: chartData, options: options });
             return window[canvasId + 'ChartInstance'];
        }

        function createComparisonRadarChart(canvasId, maleData, femaleData) {
             const ctx = document.getElementById(canvasId).getContext('2d');
             if (window[canvasId + 'ChartInstance']) { window[canvasId + 'ChartInstance'].destroy(); }
             
             const maxVal = Math.max(...Object.values(maleData), ...Object.values(femaleData), 3); // 최소값 3 보장
             
             const chartData = {
                labels: Object.values(sensoryProfiles).map(p => p.name.split(' ')[0]),
                datasets: [
                    {
                        label: '남자',
                        data: Object.keys(sensoryProfiles).map(key => maleData[key] || 0),
                        backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3B82F6', pointBackgroundColor: '#3B82F6',
                        pointBorderColor: '#fff', pointHoverBackgroundColor: '#fff', pointHoverBorderColor: '#3B82F6'
                    },
                     {
                        label: '여자',
                        data: Object.keys(sensoryProfiles).map(key => femaleData[key] || 0),
                        backgroundColor: 'rgba(236, 72, 153, 0.2)', borderColor: '#EC4899', pointBackgroundColor: '#EC4899',
                        pointBorderColor: '#fff', pointHoverBackgroundColor: '#fff', pointHoverBorderColor: '#EC4899'
                    }
                ]
            };
            const options = {
                 scales: { r: { angleLines: { display: true }, suggestedMin: 0, suggestedMax: maxVal } },
                 plugins: { legend: { position: 'bottom', } }
            };
            window[canvasId + 'ChartInstance'] = new Chart(ctx, { type: 'radar', data: chartData, options: options });
            return window[canvasId + 'ChartInstance'];
        }
        
        // --- 6. 결과 계산 로직 (수정됨) ---
        function calculateResults() {
            // 답변 완료 여부 확인
            const maleAnsweredCount = document.querySelectorAll('#male-questions input:checked').length;
            const femaleAnsweredCount = document.querySelectorAll('#female-questions input:checked').length;
            
            if (maleAnsweredCount < totalExpectedAnswers || femaleAnsweredCount < totalExpectedAnswers) {
                warningMessage.classList.remove('hidden');
                return;
            }
            warningMessage.classList.add('hidden');

            let similarityScore = 0;
            let maxSimilarityScore = 0;
            let preferenceScore = 0;
            let maxPreferenceScore = 0;

            const maleTags = {}, femaleTags = {}, maleGroupCounts = {}, femaleGroupCounts = {};
            
            questions.forEach((q) => {
                // '나의' 답변에 대한 정보 (성향 분석용)
                const maleMeNode = document.querySelector(`input[name="${q.id}-me-male"]:checked`);
                const femaleMeNode = document.querySelector(`input[name="${q.id}-me-female"]:checked`);
                const maleMeTag = maleMeNode.dataset.tag;
                const femaleMeTag = femaleMeNode.dataset.tag;

                // '나의' 답변 태그 카운트 (성향 분석용)
                if (maleMeTag) {
                    maleTags[maleMeTag] = (maleTags[maleMeTag] || 0) + 1;
                    const maleGroupKey = findTagGroupKey(maleMeTag);
                    if(maleGroupKey) maleGroupCounts[maleGroupKey] = (maleGroupCounts[maleGroupKey] || 0) + 1;
                }
                if (femaleMeTag) {
                    femaleTags[femaleMeTag] = (femaleTags[femaleMeTag] || 0) + 1;
                    const femaleGroupKey = findTagGroupKey(femaleMeTag);
                    if(femaleGroupKey) femaleGroupCounts[femaleGroupKey] = (femaleGroupCounts[femaleGroupKey] || 0) + 1;
                }
                
                const maleGroupKey = findTagGroupKey(maleMeTag);
                const femaleGroupKey = findTagGroupKey(femaleMeTag);

                // 질문 유형별 점수 계산
                switch (q.type) {
                    case 'similarity':
                        maxSimilarityScore += 2;
                        if (maleMeNode.value === femaleMeNode.value) {
                            similarityScore += 2;
                        } else if (maleGroupKey && femaleGroupKey && maleGroupKey === femaleGroupKey) {
                            // 답변은 다르지만 같은 '결' 그룹일 때 (후한 점수)
                            similarityScore += 1.5;
                        }
                        break;
                    case 'crossover':
                        maxPreferenceScore += 4; // 남->여(2점), 여->남(2점)
                        const malePartnerNode = document.querySelector(`input[name="${q.id}-partner-male"]:checked`);
                        const femalePartnerNode = document.querySelector(`input[name="${q.id}-partner-female"]:checked`);
                        
                        // 남자가 원하는 파트너 모습 <-> 여자의 실제 모습
                        if (malePartnerNode.value === femaleMeNode.value) {
                            preferenceScore += 2;
                        }
                        // 여자가 원하는 파트너 모습 <-> 남자의 실제 모습
                        if (femalePartnerNode.value === maleMeNode.value) {
                            preferenceScore += 2;
                        }
                        break;
                    case 'dynamic':
                        maxPreferenceScore += 8; // (기본성향 2 + 심도 2) * 2방향
                        const maleFollowupNode = document.querySelector(`input[name="${q.id}-followup-male"]:checked`);
                        const femaleFollowupNode = document.querySelector(`input[name="${q.id}-followup-female"]:checked`);
                        
                        // 남->여, 여->남 2방향으로 점수 계산 (각각 4점 만점)
                        const calcDynamicScore = (nodeA_Me, nodeA_Follow, nodeB_Me, nodeB_Follow) => {
                            let score = 0;
                            const groupA = findTagGroupKey(nodeA_Me.dataset.tag);
                            const groupB = findTagGroupKey(nodeB_Me.dataset.tag);
                            
                            const depthA = getDepthValue(nodeA_Follow.value);
                            const depthB = getDepthValue(nodeB_Follow.value);
                            const depthDiff = Math.abs(depthA - depthB);

                            if (nodeA_Me.value === nodeB_Me.value) {
                                // 1. 기본 성향 일치 (2점)
                                score += 2;
                                // 2. 심도 일치 (추가 2점)
                                if (depthDiff === 0) {
                                    score += 2;
                                } else if (depthDiff === 1) {
                                    score += 1.5; // 1단계 차이 (후하게)
                                } else if (depthDiff === 2) {
                                    score += 1; // 2단계 차이 (후하게)
                                }
                            } else if (groupA && groupB && groupA === groupB) {
                                // 3. 기본 성향은 다르나, '결' 그룹이 같음 (1.5점)
                                score += 1.5;
                            } else {
                                // 4. 성향/그룹 모두 달라도, 심도라도 같으면 (0.5점)
                                if (depthDiff === 0) {
                                    score += 0.5;
                                }
                            }
                            return score;
                        };
                        
                        // 남자가 원하는 파트너 모습 <-> 여자의 실제 모습
                        preferenceScore += calcDynamicScore(maleMeNode, maleFollowupNode, femaleMeNode, femaleFollowupNode);
                        // 여자가 원하는 파트너 모습 <-> 남자의 실제 모습
                        preferenceScore += calcDynamicScore(femaleMeNode, femaleFollowupNode, maleMeNode, maleFollowupNode);
                        break;
                }
            });

            // --- 7. 결과 표시 로직 (수정됨) ---
            
            // 점수 계산 (소수점 첫째 자리까지 반올림)
            const finalSimilarity = Math.round(similarityScore * 10) / 10;
            const finalPreference = Math.round(preferenceScore * 10) / 10;
            const finalTotal = Math.round((similarityScore + preferenceScore) * 10) / 10;
            
            const finalMaxSimilarity = maxSimilarityScore;
            const finalMaxPreference = maxPreferenceScore;
            const finalMaxTotal = maxSimilarityScore + maxPreferenceScore;

            // 점수 DOM 업데이트 (~점 / ~점)
            matchingScoreEl.textContent = `${finalTotal}점 / ${finalMaxTotal}점`;
            similarityScoreEl.textContent = `${finalSimilarity}점 / ${finalMaxSimilarity}점`;
            preferenceScoreEl.textContent = `${finalPreference}점 / ${finalMaxPreference}점`;
            
            const scorePercent = (finalTotal / finalMaxTotal) * 100;
            setTimeout(() => { scoreBarEl.style.width = `${scorePercent}%`; }, 100);

            // 차트 영역 다시 그리기
            scoreBreakdownEl.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                    <div class="text-center">
                        <h4 class="font-bold text-lg mb-2 text-blue-700">🤵‍♂️ 남자 '결' 분포</h4>
                        <canvas id="maleRadarChart"></canvas>
                    </div>
                    <div class="text-center">
                        <h4 class="font-bold text-lg mb-2 text-indigo-700">💖 두 분의 '결' 비교</h4>
                        <canvas id="comparisonRadarChart"></canvas>
                    </div>
                    <div class="text-center">
                         <h4 class="font-bold text-lg mb-2 text-pink-700">👰‍♀️ 여자 '결' 분포</h4>
                        <canvas id="femaleRadarChart"></canvas>
                    </div>
                </div>
            `;
            
            // 새 차트 생성
            maleRadarChart = createRadarChart('maleRadarChart', '남자', maleGroupCounts, '#3B82F6');
            femaleRadarChart = createRadarChart('femaleRadarChart', '여자', femaleGroupCounts, '#EC4899');
            comparisonRadarChart = createComparisonRadarChart('comparisonRadarChart', maleGroupCounts, femaleGroupCounts);

            // (이하 프로필 생성, 태그 생성 등은 원본과 동일)

            const dominantMaleGroupKey = Object.keys(maleGroupCounts).length > 0 ? Object.keys(maleGroupCounts).reduce((a, b) => maleGroupCounts[a] > maleGroupCounts[b] ? a : b) : 'ADAPTIVE_BALANCED';
            const dominantFemaleGroupKey = Object.keys(femaleGroupCounts).length > 0 ? Object.keys(femaleGroupCounts).reduce((a, b) => femaleGroupCounts[a] > femaleGroupCounts[b] ? a : b) : 'ADAPTIVE_BALANCED';
            const maleProfileData = sensoryProfiles[dominantMaleGroupKey];
            const femaleProfileData = sensoryProfiles[dominantFemaleGroupKey];
            combinedGradientEl.style.background = `linear-gradient(to right, ${maleProfileData.colorCode}, ${femaleProfileData.colorCode})`;
            resultVisualMaleEl.className = `mt-4 p-6 rounded-lg transition-all duration-500 ${maleProfileData.background}`;
            resultProfileTextMaleEl.textContent = generateProfile(dominantMaleGroupKey);
            resultGroupNameMaleEl.textContent = `남자는 '${maleProfileData.name}'`;
            resultGroupDescriptionMaleEl.textContent = maleProfileData.description;
            maleTagsEl.innerHTML = Object.entries(maleTags).sort((a, b) => b[1] - a[1]).map(([tag, count]) => `<span class="result-tag font-medium py-1 px-3 rounded-full text-sm">${tag}${count > 1 ? ` x${count}` : ''}</span>`).join('');
            resultVisualFemaleEl.className = `mt-4 p-6 rounded-lg transition-all duration-500 ${femaleProfileData.background}`;
            resultProfileTextFemaleEl.textContent = generateProfile(dominantFemaleGroupKey);
            resultGroupNameFemaleEl.textContent = `여자는 '${femaleProfileData.name}'`;
            resultGroupDescriptionFemaleEl.textContent = femaleProfileData.description;
            femaleTagsEl.innerHTML = Object.entries(femaleTags).sort((a, b) => b[1] - a[1]).map(([tag, count]) => `<span class="result-tag font-medium py-1 px-3 rounded-full text-sm">${tag}${count > 1 ? ` x${count}` : ''}</span>`).join('');

            // 관계 조언 수정
            if (scorePercent > 75) {
                relationshipAdviceEl.textContent = `매칭률이 매우 높습니다! 두 분은 서로의 '결'을 깊이 이해하고 있으며, 원하는 모습 또한 잘 맞춰주고 있습니다. 천생연분입니다!`;
            } else if (scorePercent > 50) {
                 relationshipAdviceEl.textContent = `좋은 매칭률입니다! '유사성 점수'와 '선호성 점수'를 확인해보세요. 만약 유사성이 낮은데 선호성이 높다면, 서로 다른 점을 잘 보완해주는 커플입니다. 반대여도 좋습니다!`;
            } else {
                 relationshipAdviceEl.textContent = `두 분은 서로 다른 '결'을 가졌습니다. 하지만 '선호성 점수'가 높다면, 서로의 다름을 존중하고 원하는 방향으로 맞춰주고 있다는 의미입니다. 다름은 성장의 기회가 될 수 있습니다.`;
            }
            if (dominantMaleGroupKey === dominantFemaleGroupKey) {
                 relationshipAdviceEl.textContent += ` (두 분은 '${maleProfileData.name}'(으)로 핵심 '결'이 동일하여 서로를 깊이 이해하는 관계입니다.)`;
            } else {
                 relationshipAdviceEl.textContent += ` (두 분은 각각 '${maleProfileData.name}', '${femaleProfileData.name}'(으)로 서로 다른 '결'을 가졌지만, 이 다름이 서로의 세계를 넓혀줄 수 있습니다.)`;
            }

            questionSection.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            document.querySelectorAll('#results .fade-in').forEach(el => el.style.opacity = 0);
            setTimeout(() => {
                 document.querySelectorAll('#results .fade-in').forEach(el => el.classList.add('is-visible'));
            }, 10);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- 8. 이벤트 리스너 ---
        retryBtn.addEventListener('click', () => {
            if (maleRadarChart) maleRadarChart.destroy();
            if (femaleRadarChart) femaleRadarChart.destroy();
            if (comparisonRadarChart) comparisonRadarChart.destroy();
            resultsContainer.classList.add('hidden');
            questionSection.classList.remove('hidden');
            // 질문 다시 렌더링 (동적 질문 초기화를 위해)
            renderQuestions(); 
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        /** 랜덤 답변 버튼 리스너 */
        randomBtn.addEventListener('click', () => {
            ['male', 'female'].forEach(gender => {
                questions.forEach(q => {
                    // 1. '나의' 질문에 랜덤 답변
                    const meRadios = document.querySelectorAll(`input[name="${q.id}-me-${gender}"]`);
                    if (meRadios.length > 0) {
                        const randomMeRadio = meRadios[Math.floor(Math.random() * meRadios.length)];
                        randomMeRadio.checked = true;
                        // 동적 질문 트리거를 위해 'change' 이벤트 강제 발생
                        randomMeRadio.dispatchEvent(new Event('change', { bubbles: true }));
                    }

                    // 2. '파트너' 질문(Crossover)에 랜덤 답변
                    if (q.type === 'crossover') {
                        const partnerRadios = document.querySelectorAll(`input[name="${q.id}-partner-${gender}"]`);
                         if (partnerRadios.length > 0) {
                            partnerRadios[Math.floor(Math.random() * partnerRadios.length)].checked = true;
                        }
                    }
                });
            });

            // 3. '동적' 질문에 랜덤 답변 (이벤트 발생 후 잠시 기다렸다가 실행)
            setTimeout(() => {
                ['male', 'female'].forEach(gender => {
                    questions.forEach(q => {
                        if (q.type === 'dynamic') {
                            const followupRadios = document.querySelectorAll(`input[name="${q.id}-followup-${gender}"]`);
                            if (followupRadios.length > 0) {
                                followupRadios[Math.floor(Math.random() * followupRadios.length)].checked = true;
                            }
                        }
                    });
                });
            }, 100); // 동적 질문이 렌더링될 시간 확보
        });

        calculateBtn.addEventListener('click', calculateResults);

        // --- 9. 초기 실행 ---
        renderQuestions();
        renderGroupDescriptions();
    </script>
</body>
</html>
